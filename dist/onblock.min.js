!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("OnBlock",[],e):"object"==typeof exports?exports.OnBlock=e():t.OnBlock=e()}(window,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}},function(t,e,n){var o,r,i;r=[n(4)],void 0===(i="function"==typeof(o=function(e){"use strict";var o=n(0),r=new((e=o(e)).default);t.exports=r})?o.apply(e,r):o)||(t.exports=i)},function(t,e,n){var o,r,i;r=[e,n(1),n(2),n(5),n(8),n(16)],void 0===(i="function"==typeof(o=function(t,e,o,r,i,u){"use strict";var c=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e=c(e),o=c(o),r=c(r),i=c(i);var s=(u=c(u)).default.nodes.reduce(function(t,e){return t[e.name]=e,t},{}),a={},f=function(t){var e=t.source,n=t.data;if(window.parent===e&&n&&null!=n.actionId&&a[n.actionId]){var o=a[n.actionId];n.pending?o.emit("pending",n.pending):(n.success?o.emit("success",n.success):n.failed&&o.emit("failed",n.failed),delete a[n.actionId])}},l=function(){function t(n){(0,e.default)(this,t),this.pack=null,this.iost=null,this.rpc=null,this.account=null,this.network=null,window.addEventListener("message",f)}return(0,o.default)(t,[{key:"newIOST",value:function(t){if(!t)throw"need IOST";if(!this.account)throw"need enable";return t.IOST.prototype.signAndSend=function(t){var e=document.domain,n=(0,r.default)(),o=new i.default;return a[n]=o,this.account?top.postMessage({action:"TX_ASK",actionId:n,data:{domain:e,tx:t}},this.onblockUrl):o.delay(0).emit("failed","no account"),o}.bind(this),t.IOST.prototype.getOnBlockAccountInfo=function(){var t=this;return new Promise(function(e,n){if(!t.account)return n("no account");var o=(0,r.default)(),u=new i.default;a[o]=u,u.on("success",function(t){return e({balances:t})}).on("failed",n),top.postMessage({action:"GET_OnBlock_ACCOUNT_INFO",actionId:o,data:{account:t.account}},t.onblockUrl)})}.bind(this),this.pack=t,this.iost=new t.IOST(u.default.defaultConfig),this.rpc=new t.RPC(new t.HTTPProvider(s[this.network||"MAINNET"].url)),this.iost.setRPC(this.rpc),this.iost.setAccount(this.iost.account),this.iost.account=new t.Account(this.account.name),this.iost.rpc=this.rpc,this.iost}},{key:"isInOnBlock",value:function(t){this.onblockUrl=t||u.default.onblockUrl;var e=window.location!=window.parent.location?document.referrer:document.location.href;return new URL(e).origin==this.onblockUrl}},{key:"enable",value:function(){var t=this;return new Promise(function(e,n){if(t.account)e(t.account.name);else{var o=(0,r.default)(),u=new i.default;a[o]=u,u.once("success",function(n){t.account=n.account,t.network=n.account.network,e(t.account.name)}).once("failed",n),top.postMessage({action:"GET_ACCOUNT",actionId:o,data:null},t.onblockUrl)}})}}]),t}();t.default=l})?o.apply(e,r):o)||(t.exports=i)},function(t,e,n){var o=n(6),r=n(7);t.exports=function(t,e,n){var i=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var u=(t=t||{}).random||(t.rng||o)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,e)for(var c=0;c<16;++c)e[i+c]=u[c];return e||r(u)}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);t.exports=function(){return n(o),o}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},function(t,e){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);t.exports=function(t,e){var o=e||0,r=n;return[r[t[o++]],r[t[o++]],r[t[o++]],r[t[o++]],"-",r[t[o++]],r[t[o++]],"-",r[t[o++]],r[t[o++]],"-",r[t[o++]],r[t[o++]],"-",r[t[o++]],r[t[o++]],r[t[o++]],r[t[o++]],r[t[o++]],r[t[o++]]].join("")}},function(t,e,n){var o,r,i;r=[e,n(1),n(2),n(9),n(12),n(13),n(15)],void 0===(i="function"==typeof(o=function(t,e,o,r,i,u,c){"use strict";var s=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e=s(e),o=s(o),r=s(r),i=s(i),u=s(u);var a=function(t){function n(){var t;return(0,e.default)(this,n),(t=(0,r.default)(this,(0,i.default)(n).call(this))).task=[],t.task.push(function(){return t.next()}),setTimeout(function(){return t.next()},0),t}return(0,u.default)(n,t),(0,o.default)(n,[{key:"delay",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.task.push(function(){return setTimeout(function(){return t.next()},e)}),this}},{key:"send",value:function(t,e){var n=this;return this.task.push(function(){n.emit(t,e),n.next()}),this}},{key:"next",value:function(){var t=this.task.shift();t&&t()}}]),n}((c=s(c)).default);t.default=a})?o.apply(e,r):o)||(t.exports=i)},function(t,e,n){var o=n(10),r=n(11);t.exports=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?r(t):e}},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=o=function(t){return n(t)}:t.exports=o=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},o(e)}t.exports=o},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var o=n(14);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}},function(t,e){function n(e,o){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,o)}t.exports=n},function(t,e,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function u(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function c(t,e,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new u(n,o||t,i),s=r?r+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],c]:t._events[s].push(c):(t._events[s]=c,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)o.call(t,e)&&n.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,u=new Array(i);o<i;o++)u[o]=n[o].fn;return u},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,i,u){var c=r?r+t:t;if(!this._events[c])return!1;var s,a,f=this._events[c],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,o),!0;case 5:return f.fn.call(f.context,e,n,o,i),!0;case 6:return f.fn.call(f.context,e,n,o,i,u),!0}for(a=1,s=new Array(l-1);a<l;a++)s[a-1]=arguments[a];f.fn.apply(f.context,s)}else{var p,d=f.length;for(a=0;a<d;a++)switch(f[a].once&&this.removeListener(t,f[a].fn,void 0,!0),l){case 1:f[a].fn.call(f[a].context);break;case 2:f[a].fn.call(f[a].context,e);break;case 3:f[a].fn.call(f[a].context,e,n);break;case 4:f[a].fn.call(f[a].context,e,n,o);break;default:if(!s)for(p=1,s=new Array(l-1);p<l;p++)s[p-1]=arguments[p];f[a].fn.apply(f[a].context,s)}}return!0},a.prototype.on=function(t,e,n){return c(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return c(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return s(this,i),this;var u=this._events[i];if(u.fn)u.fn!==e||o&&!u.once||n&&u.context!==n||s(this,i);else{for(var c=0,a=[],f=u.length;c<f;c++)(u[c].fn!==e||o&&!u[c].once||n&&u[c].context!==n)&&a.push(u[c]);a.length?this._events[i]=1===a.length?a[0]:a:s(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&s(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},function(t,e,n){var o,r,i;r=[e],void 0===(i="function"==typeof(o=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e={defaultConfig:{gasRatio:1,gasLimit:1e5,delay:0,expiration:90,defaultLimit:"unlimited"},nodes:[{name:"MAINNET",url:"https://api.iost.io",chain_id:1024,default:!0},{name:"TESTNET",url:"https://test.api.iost.io",chain_id:1023,default:!0}],onblockUrl:"https://onblock.me"};t.default=e})?o.apply(e,r):o)||(t.exports=i)}])});